@using web_banvemaybay.Models;
@model IEnumerable<Ve>
@{
    ViewBag.Title = "Checkve";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@if (!string.IsNullOrEmpty(ViewBag.Message))
{
    <div id="thongbao">
        <div class="thongbao">
            <div class="thongbao-icon">
                <i class="fa-solid fa-triangle-exclamation"></i>
            </div>
            <div class="thongbao-body">
                <p>Thông báo</p>
                <p class="ndtb">@ViewBag.Message</p>
            </div>
            <div class="thongbao-close">
                <i class="fa-solid fa-xmark"></i>
            </div>
        </div>
    </div>
}
else
{
    <div id="thongbao" style="display:none !important">
        <div class="thongbao">
            <div class="thongbao-icon">
                <i class="fa-solid fa-triangle-exclamation"></i>
            </div>
            <div class="thongbao-body">
                <p>Thông báo</p>
                <p class="ndtb"></p>

            </div>
            <div class="thongbao-close">
                <i class="fa-solid fa-xmark"></i>
            </div>
        </div>
    </div>
}
<div class="check">
    <div class="check-main">
        <div class="flight-details">
            <div class="checkve-heading">
                Chi tiết vé máy bay của bạn
            </div>
            @{
                web_banvemaybayEntities db = new web_banvemaybayEntities();
                foreach (var item in Model.OrderByDescending(c => c.IDve))
                {
                    <div class="checkve-body">
                        <div class="checkve-img">
                            <img src="@item.Chuyenbay.HangHK.Hinhanh" alt="">
                        </div>
                        <div class="checkve-chuyenbay">
                            <p>Mã chuyến bay: <b>@item.Chuyenbay.IDchuyenbay</b></p>
                            @if (@item.IDchuyenbayve != null)
                            {
                                <p>Chuyến bay: <b>Khứ hồi </b></p>
                            }
                            else
                            {
                                <p>Chuyến bay: <b>Một chiều </b></p>
                            }
                            <p>Hạng vé: <b>@item.Hangve.TenHangve</b> </p>
                            <p>Thời gian: <b>02h 30p</b></p>
                        </div>
                        <div class="checkve-go">
                            <p>Đi từ: <b>@item.Chuyenbay.Diadiemden</b></p>
                            <p>Cất cánh: <b>@item.Chuyenbay.Ngaydi.Value.ToString("HH:mm")</b></p>
                            <p>Ngày: <b>@item.Chuyenbay.Ngaydi.Value.ToString("dd/MM/yyyy")</b></p>
                        </div>
                        <div class="checkve-to">
                            <p>Đến: <b>@item.Chuyenbay.Diadiemdi</b></p>
                            <p>
                                Hạ cánh: <b>
                                    @item.Chuyenbay.Ngaydi.Value.AddHours(2).AddMinutes(30).ToString("HH:mm")
                                </b>
                            </p>
                            <p>
                                Ngày: <b>
                                    @item.Chuyenbay.Ngaydi.Value.AddHours(2).AddMinutes(30).ToString("dd/MM/yyyy")
                                </b>
                            </p>
                        </div>
                    </div>
                    if (item.IDchuyenbayve == null)
                    {
                        int check = int.Parse(@Session["mavemuontra"].ToString());
                        var checkma = db.Ve.Where(c => c.IDve == check).FirstOrDefault();
                        if (checkma.Tinhtrang == "Chờ thanh toán" || checkma.Tinhtrang == "Đã thanh toán")
                        {
                            <a class="btn-huy" href="#" onclick="confirmAction()">
                                Hủy vé
                            </a>
                        }
                    }
                    <input type="hidden" name="idcu" value="@Session["idcu"]" />
                }
            }
        </div>
        @{
            foreach (var item in Model.OrderByDescending(c => c.IDve))
            {
                if (item.IDchuyenbayve != null)
                {
                    var check = db.Ve.Where(c => c.IDve == item.IDchuyenbayve).FirstOrDefault();
                        <div class="flight-details">

                            <div class="checkve-body">
                                <div class="checkve-img">
                                    <img src="@check.Chuyenbay.HangHK.Hinhanh" alt="">
                                </div>
                                <div class="checkve-chuyenbay">
                                    <p>Mã chuyến bay: <b>@check.Chuyenbay.IDchuyenbay</b></p>
                                    <p>Chuyến bay: <b>Khứ hồi </b></p>
                                    <p>Hạng vé: <b>@item.Hangve.TenHangve</b> </p>
                                    <p>Thời gian: <b>02h 30p</b></p>
                                </div>
                                <div class="checkve-go">
                                    <p>Đi từ: <b>@check.Chuyenbay.Diadiemden</b></p>
                                    <p>Cất cánh: <b>@check.Chuyenbay.Ngaydi.Value.ToString("HH:mm")</b></p>
                                    <p>Ngày: <b>@check.Chuyenbay.Ngaydi.Value.ToString("dd/MM/yyyy")</b></p>
                                </div>
                                <div class="checkve-to">
                                    <p>Đến: <b>@check.Chuyenbay.Diadiemdi</b></p>
                                    <p>
                                        Hạ cánh: <b>
                                            @check.Chuyenbay.Ngaydi.Value.AddHours(2).AddMinutes(30).ToString("HH:mm")
                                        </b>
                                    </p>
                                    <p>
                                        Ngày: <b>
                                            @check.Chuyenbay.Ngaydi.Value.AddHours(2).AddMinutes(30).ToString("dd/MM/yyyy")
                                        </b>
                                    </p>
                                </div>
                            </div>
                        </div>
                    int mave = int.Parse(@Session["mavemuontra"].ToString());
                    var kt = db.Ve.Where(c => c.IDve == mave).FirstOrDefault();
                    if (kt.Tinhtrang == "Chờ thanh toán" || kt.Tinhtrang == "Đã thanh toán")
                    {
                        <a class="btn-huy" style="flex:1;" href="#" onclick="confirmAction()">
                            Hủy vé
                        </a>
                    }
                }

            }
        }
    </div>
    
</div>



<script>
function confirmAction() {
    // Sử dụng hàm `confirm` để hiển thị hộp thoại thông báo
    var confirmation = confirm("Bạn có chắc chắn muốn thực hiện hành động này?");

    // Kiểm tra kết quả của hộp thoại thông báo
    if (confirmation) {
        // Nếu người dùng chọn "Yes," thực hiện chuyển hướng
        window.location.href = "@Url.Action("Index","Huyve")";
    } else {
        // Nếu người dùng chọn "No," sử dụng URL trang hiện tại để ở lại trang cũ
        window.location.href = currentURL;
    }
}
</script>
