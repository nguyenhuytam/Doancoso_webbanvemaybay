@model web_banvemaybay.Models.Hanhli
@{
    ViewBag.Title = "hl";
    Layout = null;
}

<h2>hl</h2>

@{
    web_banvemaybay.Models.web_banvemaybayEntities db = new web_banvemaybay.Models.web_banvemaybayEntities();
    var hanhlidi = db.Hanhli.ToList();
    <select name="to" id="tohl">
        @foreach (var item in hanhlidi)
        {
            <option value="@item.IDhanhli">@item.Kg</option>
        }
    </select>
    var hanhlive = db.Hanhli.ToList();
    <select name="from" id="fromhl">
        @foreach (var item in hanhlive)
        {
            <option value="@item.IDhanhli">@item.Kg</option>
        }
    </select>
    <p id="giatien">@Session["giatien"]</p>
    <a class="btn-choose" href="@Url.Action("Information","Flight")">
        Chọn
    </a>
}

@{
    int idHvto = int.Parse(Session["idTo"].ToString());
    int idHvFrom = int.Parse(Session["idFrom"].ToString());
    int sl = int.Parse(Session["tongsl"].ToString());
    var itemTo = db.Chuyenbay.Where(c => c.IDchuyenbay == idHvto).FirstOrDefault();
    var itemFrom = db.Chuyenbay.Where(c => c.IDchuyenbay == idHvFrom).FirstOrDefault();
    var hangve = db.Hangve.ToList();
    double tong = double.Parse(Session["giatien"].ToString());
    double tonggiatien = 0;
}
<div id="form2">
    <!-- Nội dung form tại đây -->
    <select name="idHangve" id="idHangve">
        @{ 
            if (itemTo.PhoThong < sl && itemTo.ThuongGia >= sl)
            {
                var selectedHangve = hangve.FirstOrDefault(h => h.IDhangve == 1);
                tonggiatien = tong * sl;
                Session["giatien"] = tonggiatien;
                <option value="@selectedHangve.IDhangve">@selectedHangve.TenHangve</option>
            }
            else if (itemTo.PhoThong >= sl && itemTo.ThuongGia < sl)
            {
                var selectedHangve = hangve.FirstOrDefault(h => h.IDhangve == 2);
                <option value="@selectedHangve.IDhangve">@selectedHangve.TenHangve</option>
            }
            else if (itemTo.PhoThong >= sl && itemTo.ThuongGia >= sl)
            {
                foreach (var item in hangve)
                {
                <option value="@item.IDhangve" @(item.IDhangve == 2 ? "selected" : "")>@item.TenHangve</option>
                    }
             }
            }
    </select>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    $(document).ready(function () {
        // Sự kiện thay đổi giá trị select
        $("#idHangve").change(function () {
            updateTotalPrice();
        });

        function updateTotalPrice() {
            // Lấy giá trị idHangve từ dropdown
            var idHangve = $('#idHangve').val();

            // Kiểm tra nếu có chuyến đi được chọn  // Gọi API hoặc thực hiện các xử lý cần thiết để lấy giá tiền từ server
                // Ở đây, giả sử có một API có thể được gọi với idHangve để lấy giá tiền
                $.ajax({
                    url: '/Flight/Hv', // Điều chỉnh đường dẫn tương ứng với ứng dụng của bạn
                    method: 'POST', // Phương thức POST
                    data: { idHangve: idHangve },
                    success: function (result) {
                        console.log(result);
                        $("#giatien").text(result);
                    },
                    error: function () {
                        alert("Lỗi");
                    }
                });
        }
    });
</script>

<script>
    $(document).ready(function () {
        // Đoạn mã jQuery của bạn ở đây
        $("#tohl, #fromhl").change(function () {
            updateSessionPrice();
        });

        function updateSessionPrice() {
            var toId = $("#tohl").val(); // Sửa đây để lấy giá trị từ select "tohl"
            var fromId = $("#fromhl").val();

            $.ajax({
                type: "POST",
                url: "/Flight/UpdateSessionPrice",
                data: { toId: toId, fromId: fromId },
                success: function (result) {
                    console.log(result);
                    $("#giatien").text(result);
                },
                error: function () {
                    alert("Lỗi");
                }
            });
        }
    });
</script>
